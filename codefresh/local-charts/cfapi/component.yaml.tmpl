# This file is in here to serve the local development using Merlin

{{ $port := GetAvailablePort }}

operators:

- name: connect
  type: cmd
  description: Establish connection to cluster
  spec:
    program: telepresence
    env:
    - KUBECONFIG={{ .Merlin.kube.path }}
    - API_PUBLIC_PORT={{ $port }}
    args:
    - -s
    - {{ .Merlin.kube.namespace }}-cfapi
    - --namespace
    - {{ .Merlin.kube.namespace }}
    - --context
    - {{ .Merlin.kube.context }}
    - --expose
    - {{ $port }}:{{ .Values.targetPort }}
    - --expose
    - {{ GetAvailablePort }}:{{ .Values.targetInternalPort }}
    {{ if .Values.telepresence.run }}
    - {{ .Values.telepresence.run }}
    {{ else }}
    - --run-shell
    {{ end }}
 
- name: start
  type: cmd
  description: Start nodejs application
  spec:
    program: node
    env:
    - PORT={{ env.Getenv "API_PUBLIC_PORT" }}
    - FORMAT_LOGS_TO_ELK=false
    args:
    - --inspect={{ GetAvailablePort }}
    - {{ .Values.program }}





